# Распознавание центров круговых меток

## Цель проекта

Требуется определять на фотографиях положение белых круговых меток.

## Дано

- Промышленная камера Daheng ME2P-1230-23U3M/C с инфракрасной вспышкой
- Угол наклона нормали метки к камере может достигать до 45 градусов (овальность метки)

## Что должно быть на выходе

Программный модуль (SDK) / готовое приложение (UI на усмотрение), на вход которого подаётся изображение или серия изображений, на выход - набор данных меток. 

## Структура репозитория

- researches, another_reaserches: сырые модели для исследования, не для приложения
- app: файлы бекенда и фронтенда приложения
- detectors: модели, которые можно подгружать в приложение

## Установка зависимостей

Для установки необходимых зависимостей выполните следующую команду:

```bash
pip install -r requirements.txt
```

## Развертывание в Docker

### Сборка Docker-образа

Для сборки Docker-образа выполните команду:

```bash
docker build -t circles-app .
```

### Запуск контейнера

После успешной сборки образа запустите контейнер с помощью команды:

```bash
docker run --rm -p 8000:8000 circles-app
```

## Детекторы

- **blind_marker_detector**: Иерархический подход с постепенным снижением точности - алгоритм пытается применить самые точные методы сначала, переходя к более грубым при неудаче. Уровни: взвешенный центроид -> Ellipse fitting (AMS) -> ROI-based детектирование -> GT Fallback
- **contour_ellipse_detector**: Использует пороговую бинаризацию с морфологическими операциями для выделения областей интереса, находит их контуры, фильтрует по площади и форме (круглость, соотношение сторон), затем уточняет координаты центра с субпиксельной точностью с помощью центра масс и/или алгоритма cornerSubPix
- **gaussian_fitter_detector**: Подгонка двумерного гауссиана к распределению яркости с конечным вычислением координат центра пика как координат центра объекта. Вычисление нормали объекта с использованием полученных в ходе аппроксимации параметров гауссианы.
- **hough_circles**: Использует преобразование Хафа для обнаружения кругов на изображении, а затем уточняет координаты их центров, применяя метод моментов или взвешенные градиенты к области интереса.
- **unet_heatmap_detector**: Использование модели глубокого обучения для восстановления вероятностной карты (heatmap) и прогнозирования центра объекта как центроида heatmap. Вычисление нормали объекта с помощью аппроксимации эллипсом и использованием его параметров.

## Использование Python

### Метод прогнозирования heatmap

**Обучение модели:**

```bash
python researches/heatmap_centroid_prediction/training.py --data_csv PATH_TO_YOUR_GT_DATA --image_folder PATH_TO_YOUR_IMAGES
```

**Валидация модели:**

```bash
python researches/heatmap_centroid_prediction/evaluation.py --data_csv PATH_TO_YOUR_GT_DATA --image_folder PATH_TO_YOUR_IMAGES --model_path PATH_TO_MODEL_WEIGHTS --config PATH_TO_MODEL_CONFIGURATION
```

**Инференс на одном изображении:**

```bash
python researches/heatmap_centroid_prediction/inference.py --image_path PATH_TO_YOUR_IMAGE
```

### Метод нахождения через контуры
**Запуск алгоритма для одного изображения:**

```bash
python researches/circles.py --image_path PATH_TO_YOUR_IMAGE
```


**Запуск алгоритма для серии изображений:**

```bash
python researches/circles.py --image_path PATH_TO_YOUR_IMAGE_FOLDER
```
